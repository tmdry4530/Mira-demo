---
description: system-architecture
globs: 
alwaysApply: false
---
# Mira í•©ì˜ë©”ì»¤ë‹ˆì¦˜ ì›¹ì•± - ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ì„¤ê³„

## ğŸ“‹ ê°œìš”

ì´ ë£°ì€ Mira í•©ì˜ë©”ì»¤ë‹ˆì¦˜ ì›¹ì•±ì˜ ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ì™€ ê¸°ìˆ  ìš”êµ¬ì‚¬í•­ì„ ë°”íƒ•ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥í•˜ê³  ì•ˆì •ì ì¸ ì‹œìŠ¤í…œ êµ¬ì¡°ë¥¼ ì„¤ê³„í•©ë‹ˆë‹¤.

**ì°¸ì¡° ë£°**: 
- [mira-prd.mdc](mdc:.cursor/rules/mira-prd.mdc) - ê¸°ìˆ  ìŠ¤íƒ ì •ì˜
- [user-scenarios.mdc](mdc:.cursor/rules/user-scenarios.mdc) - í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨
- [ui-ux-wireframes.mdc](mdc:.cursor/rules/ui-ux-wireframes.mdc) - UI ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

## ğŸ—ï¸ ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```mermaid
graph TB
    subgraph "Client Layer"
        U[User Browser]
        M[Mobile App]
    end
    
    subgraph "Frontend Layer (Next.js)"
        R[React Router]
        C1[Landing Component]
        C2[Generation Component] 
        C3[Split Component]
        C4[Verification Component]
        C5[Results Component]
        
        S[State Management<br/>Zustand/Context]
        UI[UI Components<br/>Tailwind CSS]
        A[Animations<br/>Framer Motion]
    end
    
    subgraph "API Layer (Node.js)"
        API[Express Server]
        MW[Middleware<br/>Auth, CORS, Rate Limit]
        RT1[/api/question]
        RT2[/api/generate] 
        RT3[/api/split]
        RT4[/api/verify-v2]
        RT5[/api/consensus]
        
        BL[Business Logic]
        EH[Error Handling]
        WS[WebSocket/SSE<br/>Real-time Updates]
    end
    
    subgraph "External Services"
        GMA[Gemini API<br/>ë‹µë³€ ìƒì„±]
        GM1[Gemini API<br/>ëª…ì œ ë¶„í•  ë° ê²€ì¦]
        
        subgraph "16ê°œ ê²€ì¦ì í´ëŸ¬ìŠ¤í„° (4x4 ê·¸ë¦¬ë“œ)"
            V1[Validator 1-4<br/>ë…¼ë¦¬ ê²€ì¦ì]
            V2[Validator 5-8<br/>ì‚¬ì‹¤ ê²€ì¦ì] 
            V3[Validator 9-12<br/>ë§¥ë½ ê²€ì¦ì]
            V4[Validator 13-16<br/>ì¢…í•© ê²€ì¦ì]
        end
    end
    
    subgraph "Infrastructure"
        LB[Load Balancer]
        CD[CDN]
        MON[Monitoring<br/>Logs, Metrics]
    end
    
    %% Connections
    U --> CD
    M --> CD
    CD --> LB
    LB --> R
    
    R --> C1
    R --> C2
    R --> C3
    R --> C4
    R --> C5
    
    C1 -.-> S
    C2 -.-> S
    C3 -.-> S
    C4 -.-> S
    C5 -.-> S
    
    S --> API
    API --> MW
    MW --> RT1
    MW --> RT2
    MW --> RT3
    MW --> RT4
    MW --> RT5
    
    RT1 --> BL
    RT2 --> BL
    RT3 --> BL
    RT4 --> BL
    RT5 --> BL
    
    BL --> EH
    BL --> GMA
    BL --> GM1
    BL --> V1
    BL --> V2
    BL --> V3
    BL --> V4
    
    API --> WS
    WS --> S
    
    API --> MON
    GMA --> MON
    GM1 --> MON
```

## ğŸ”„ ë°ì´í„° í”Œë¡œìš° ì•„í‚¤í…ì²˜ (16ê°œ ê²€ì¦ì)

```mermaid
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant FE as Frontend
    participant API as Backend API
    participant GMA as Gemini (Answer)
    participant GM as Gemini (Split & Verify)
    participant V1 as Validator 1-4
    participant V2 as Validator 5-8
    participant V3 as Validator 9-12
    participant V4 as Validator 13-16
    participant WS as WebSocket
    
    Note over User, WS: 1. ì§ˆë¬¸ ì…ë ¥ ë‹¨ê³„
    User->>FE: ì§ˆë¬¸ ì…ë ¥
    FE->>API: POST /api/question
    API-->>FE: ì§ˆë¬¸ ê²€ì¦ ì™„ë£Œ
    
    Note over User, WS: 2. AI ë‹µë³€ ìƒì„± ë‹¨ê³„
    API->>GMA: ë‹µë³€ ìƒì„± ìš”ì²­ (gemini-2.5-flash-lite-preview-06-17)
    API->>WS: ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ (10%)
    WS-->>FE: ì‹¤ì‹œê°„ ì§„í–‰ë¥ 
    FE-->>User: ë¡œë”© í™”ë©´ ì—…ë°ì´íŠ¸
    
    GMA-->>API: AI ë‹µë³€ ë°˜í™˜
    API->>WS: ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ (40%)
    WS-->>FE: ë‹µë³€ ìƒì„± ì™„ë£Œ
    
    Note over User, WS: 3. ëª…ì œ ë¶„í•  ë‹¨ê³„
    API->>GM: ëª…ì œ ë¶„í•  ìš”ì²­ (Rate Limited)
    API->>WS: ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ (50%)
    GM-->>API: ë¶„í• ëœ ëª…ì œë“¤
    API->>WS: ë¶„í•  ì™„ë£Œ (60%)
    WS-->>FE: ëª…ì œ ì‹œê°í™”
    
    Note over User, WS: 4. 16ê°œ ê²€ì¦ì ë°°ì¹˜ ì²˜ë¦¬ ë‹¨ê³„
    Note over API: Rate Limiting: 2ê°œì”© ë°°ì¹˜, 6ì´ˆ ê°„ê²©
    
    loop ë°°ì¹˜ 1 (Validator 1-2)
        API->>V1: ê²€ì¦ ìš”ì²­ (ë…¼ë¦¬)
        API->>V1: ê²€ì¦ ìš”ì²­ (ë…¼ë¦¬)
        V1-->>API: ê²€ì¦ ê²°ê³¼ 1-2
        API->>WS: ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ (65%)
        WS-->>FE: 4x4 ê·¸ë¦¬ë“œ ì—…ë°ì´íŠ¸
        FE-->>User: ê²€ì¦ì ì¹´ë“œ ìƒíƒœ ë³€ê²½
        Note over API: 6ì´ˆ ëŒ€ê¸° (Rate Limit ì¤€ìˆ˜)
    end
    
    loop ë°°ì¹˜ 2-8 (Validator 3-16)
        API->>V2: ê²€ì¦ ìš”ì²­ (ì‚¬ì‹¤)
        API->>V3: ê²€ì¦ ìš”ì²­ (ë§¥ë½)
        API->>V4: ê²€ì¦ ìš”ì²­ (ì¢…í•©)
        V2-->>API: ê²€ì¦ ê²°ê³¼
        V3-->>API: ê²€ì¦ ê²°ê³¼
        V4-->>API: ê²€ì¦ ê²°ê³¼
        API->>WS: ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ (70-95%)
        WS-->>FE: ì‹¤ì‹œê°„ 4x4 ê·¸ë¦¬ë“œ ì—…ë°ì´íŠ¸
        FE-->>User: ê²€ì¦ì ìƒíƒœ ì‹œê°í™”
        Note over API: 6ì´ˆ ëŒ€ê¸° (Rate Limit ì¤€ìˆ˜)
    end
    
    Note over User, WS: 5. í•©ì˜ ë° ê²°ê³¼ ë‹¨ê³„ (16ê°œ ê¸°ì¤€)
    API->>API: ê³¼ë°˜ìˆ˜ íŒì • ë¡œì§ (9/16)
    API->>WS: ìµœì¢… ê²°ê³¼ (100%)
    WS-->>FE: ê²€ì¦ ì™„ë£Œ
    FE-->>User: ê²°ê³¼ í™”ë©´ í‘œì‹œ
```

## ğŸ›ï¸ ì»´í¬ë„ŒíŠ¸ ì•„í‚¤í…ì²˜ (16ê°œ ê²€ì¦ì)

```mermaid
graph LR
    subgraph "í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸"
        LP[LandingPage]
        GP[GenerationPage]
        SP[SplitPage] 
        VP[VerificationPage<br/>4x4 Grid]
        RP[ResultsPage]
    end
    
    subgraph "ê³µí†µ ì»´í¬ë„ŒíŠ¸"
        H[Header]
        L[Loading]
        P[ProgressBar]
        B[Button]
        I[Input]
        E[ErrorBoundary]
        VG[4x4 Validator Grid]
        VC[Validator Card]
    end
    
    subgraph "ìƒíƒœ ê´€ë¦¬"
        GS[Global State<br/>Zustand Store]
        QS[Question State]
        AS[Answer State]
        PS[Proposition State]
        VS[Verification State<br/>16 Validators]
        RS[Result State]
    end
    
    subgraph "API ê³„ì¸µ"
        QH[Question Handler]
        GH[Generation Handler]
        SH[Split Handler]
        VH[Verification Handler<br/>Rate Limited]
        RH[Result Handler]
    end
    
    %% ì»´í¬ë„ŒíŠ¸ ê´€ê³„
    LP --> H
    LP --> I
    LP --> B
    
    GP --> H
    GP --> L
    GP --> P
    
    SP --> H
    SP --> P
    
    VP --> H
    VP --> VG
    VP --> VC
    VP --> P
    
    RP --> H
    RP --> B
    
    %% ìƒíƒœ ê´€ë¦¬ ì—°ê²°
    LP -.-> QS
    GP -.-> AS
    SP -.-> PS
    VP -.-> VS
    RP -.-> RS
    
    QS --> GS
    AS --> GS
    PS --> GS
    VS --> GS
    RS --> GS
    
    %% API ì—°ê²°
    GS --> QH
    GS --> GH
    GS --> SH
    GS --> VH
    GS --> RH
```

## âš™ï¸ ê¸°ìˆ  ìŠ¤íƒ ì„¸ë¶€ì‚¬í•­ (ì—…ë°ì´íŠ¸)

### Frontend Stack
```
Next.js 15.1.8 (App Router)
â”œâ”€â”€ React 19.0.0 (Server Components)
â”œâ”€â”€ TypeScript 5.7.x (íƒ€ì… ì•ˆì „ì„±)
â”œâ”€â”€ Zustand 5.x (ìƒíƒœ ê´€ë¦¬)
â”œâ”€â”€ Tailwind CSS 4.x (ìŠ¤íƒ€ì¼ë§)
â”œâ”€â”€ Framer Motion 12.x (ì• ë‹ˆë©”ì´ì…˜)
â”œâ”€â”€ React Query 5.x (ì„œë²„ ìƒíƒœ)
â””â”€â”€ WebSocket Client (ì‹¤ì‹œê°„)
```

### Backend Stack  
```
Node.js 22.x (Express.js)
â”œâ”€â”€ TypeScript 5.7.x (íƒ€ì… ì•ˆì „ì„±)
â”œâ”€â”€ Express.js 5.x (ì›¹ í”„ë ˆì„ì›Œí¬)
â”œâ”€â”€ Socket.io (ì‹¤ì‹œê°„ í†µì‹ )
â”œâ”€â”€ Axios 1.7.x (HTTP í´ë¼ì´ì–¸íŠ¸)
â”œâ”€â”€ Rate Limiting (ë¶„ë‹¹ 12ê°œ ìš”ì²­)
â”œâ”€â”€ CORS (ë³´ì•ˆ)
â””â”€â”€ Winston (ë¡œê¹…)
```

### External APIs (ì—…ë°ì´íŠ¸)
```
AI Services
â”œâ”€â”€ Gemini 2.5 Flash Lite Preview (ë‹µë³€ ìƒì„±)
â”œâ”€â”€ Gemini 2.5 Flash Lite Preview (ëª…ì œ ë¶„í• )
â””â”€â”€ 16x Gemini 2.5 Flash Lite Preview (ë°°ì¹˜ ê²€ì¦)
```

## ğŸ”’ ë³´ì•ˆ ì•„í‚¤í…ì²˜ (Rate Limiting ê°•í™”)

```mermaid
graph TD
    subgraph "ë³´ì•ˆ ê³„ì¸µ"
        CDN[CDN + DDoS Protection]
        LB[Load Balancer + SSL]
        WAF[Web Application Firewall]
        
        subgraph "API ë³´ì•ˆ"
            RL[Rate Limiting<br/>ë¶„ë‹¹ 12ê°œ ìš”ì²­]
            CORS[CORS Policy] 
            VAL[Input Validation]
            AUTH[API Key Management]
            EB[429 Error Handling<br/>45ì´ˆ ì¬ì‹œë„]
        end
        
        subgraph "ë°ì´í„° ë³´ì•ˆ"
            ENC[Data Encryption]
            LOG[Audit Logging]
            MON[Security Monitoring]
        end
    end
    
    Internet --> CDN
    CDN --> LB
    LB --> WAF
    WAF --> RL
    RL --> CORS
    CORS --> VAL
    VAL --> AUTH
    AUTH --> EB
    
    EB --> ENC
    ENC --> LOG
    LOG --> MON
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§ & ìš´ì˜ (ì—ëŸ¬ í•´ê²° í¬í•¨)

### í•µì‹¬ ë©”íŠ¸ë¦­
- **ì‘ë‹µ ì‹œê°„**: API í˜¸ì¶œë³„ latency ì¶”ì 
- **ì„±ê³µë¥ **: ê° AI API í˜¸ì¶œ ì„±ê³µ/ì‹¤íŒ¨ìœ¨ (404, 429 ì˜¤ë¥˜ ëª¨ë‹ˆí„°ë§)
- **ë™ì‹œ ì‚¬ìš©ì**: ì‹¤ì‹œê°„ ì ‘ì†ì ìˆ˜
- **ê²€ì¦ ì •í™•ë„**: 16ê°œ ê²€ì¦ìë³„ ê²€ì¦ ê²°ê³¼ ë¶„ì„
- **Rate Limit ì¤€ìˆ˜ìœ¨**: ë¶„ë‹¹ ìš”ì²­ ìˆ˜ ëª¨ë‹ˆí„°ë§

### ì•Œë¦¼ ì„¤ì •
- API ì‘ë‹µ ì‹œê°„ > 5ì´ˆ
- AI API ì‹¤íŒ¨ìœ¨ > 10%
- 429 Rate Limit ì˜¤ë¥˜ ê°ì§€
- React í‚¤ ì¤‘ë³µ ì˜¤ë¥˜ ë°œìƒ
- ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥  > 80%

### í•´ê²°ëœ ì˜¤ë¥˜ ëª¨ë‹ˆí„°ë§
- **404 ì—”ë“œí¬ì¸íŠ¸ ì˜¤ë¥˜**: `/api/verify-v2` ë¼ìš°íŒ… ì •ìƒí™”
- **429 Rate Limit ì˜¤ë¥˜**: ë°°ì¹˜ ì²˜ë¦¬ì™€ ëŒ€ê¸° ì‹œê°„ìœ¼ë¡œ í•´ê²°
- **React í‚¤ ì¤‘ë³µ**: ê³ ìœ  í‚¤ ìƒì„±ìœ¼ë¡œ ë Œë”ë§ ì•ˆì •í™”

## ğŸš€ í™•ì¥ì„± ê³ ë ¤ì‚¬í•­ (16ê°œ ê²€ì¦ì ê¸°ì¤€)

### ìˆ˜í‰ì  í™•ì¥
- **Frontend**: CDN + ë‹¤ì¤‘ ì¸ìŠ¤í„´ìŠ¤
- **Backend**: ë¡œë“œ ë°¸ëŸ°ì„œ + ë‹¤ì¤‘ ì„œë²„
- **AI API**: ë°°ì¹˜ ì²˜ë¦¬ ìµœì í™” + ìºì‹±

### ì„±ëŠ¥ ìµœì í™” (ì—…ë°ì´íŠ¸)
- **API ì‘ë‹µ ìºì‹±**: ë™ì¼ ì§ˆë¬¸ ê²°ê³¼ ìºì‹±
- **ì´ë¯¸ì§€ ìµœì í™”**: SVG ì™€ì´ì–´í”„ë ˆì„ ìµœì í™”
- **ì½”ë“œ ë¶„í• **: í˜ì´ì§€ë³„ lazy loading
- **WebSocket í’€ë§**: ì—°ê²° ì¬ì‚¬ìš©
- **4x4 ê·¸ë¦¬ë“œ ìµœì í™”**: ê²€ì¦ì ì¹´ë“œ ë Œë”ë§ ìµœì í™”
- **Rate Limiting**: Gemini API ì œì•½ ì¤€ìˆ˜ë¡œ ì•ˆì •ì„± í™•ë³´

## âœ… êµ¬í˜„ ìš°ì„ ìˆœìœ„ (ì™„ë£Œ ìƒíƒœ)

### Phase 1: í•µì‹¬ ì¸í”„ë¼ (ì™„ë£Œ) âœ…
- [x] Next.js í”„ë¡œì íŠ¸ ì„¤ì •
- [x] Express.js API ì„œë²„
- [x] Gemini API ì—°ë™ (gemini-2.5-flash-lite-preview-06-17)
- [x] ê¸°ë³¸ ì—ëŸ¬ í•¸ë“¤ë§ (404, 429 í•´ê²°)

### Phase 2: í•µì‹¬ ê¸°ëŠ¥ (ì™„ë£Œ) âœ…
- [x] ì „ì²´ í”Œë¡œìš° êµ¬í˜„ (16ê°œ ê²€ì¦ì)
- [x] WebSocket ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- [x] ìƒíƒœ ê´€ë¦¬ ì‹œìŠ¤í…œ
- [x] 4x4 ê·¸ë¦¬ë“œ UI ê°œë°œ
- [x] React í‚¤ ì¤‘ë³µ ì˜¤ë¥˜ í•´ê²°

### Phase 3: ìµœì í™” (ì™„ë£Œ) âœ…
- [x] Rate Limiting ì„±ëŠ¥ íŠœë‹
- [x] ë³´ì•ˆ ê°•í™” (429 ì—ëŸ¬ ë³µêµ¬)
- [x] ëª¨ë‹ˆí„°ë§ ì„¤ì •
- [x] UI/UX ê°œì„  (ë²”ë¡€ ì œê±°, ê·¸ë¦¬ë“œ ìµœì í™”)

ì´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ëŠ” 16ê°œ ê²€ì¦ì ê¸°ë°˜ì˜ í™•ì¥ ê°€ëŠ¥í•˜ê³  ìœ ì§€ë³´ìˆ˜ê°€ ìš©ì´í•œ êµ¬ì¡°ë¡œ ì„¤ê³„ë˜ì—ˆìœ¼ë©°, Rate Limitingê³¼ ì—ëŸ¬ í•¸ë“¤ë§ì„ í†µí•´ ì•ˆì •ì„±ì„ í™•ë³´í–ˆìŠµë‹ˆë‹¤.

