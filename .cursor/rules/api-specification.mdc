---
description: api-specification
globs: 
alwaysApply: false
---
# Mira ν•©μλ©”μ»¤λ‹μ¦ μ›Ήμ•± - API λ…μ„Έμ„

## π“‹ κ°μ”

μ΄ λ£°μ€ Mira μ›Ήμ•±μ API μ—”λ“ν¬μΈνΈ λ…μ„Έλ¥Ό μ •μν•©λ‹λ‹¤.

**μ°Έμ΅° λ£°**: 
- [mira-prd.mdc](mdc:.cursor/rules/mira-prd.mdc) - μ‚¬μ©μ μ—¬μ • λ° κΈ°λ¥ μ”κµ¬μ‚¬ν•­
- [system-architecture.mdc](mdc:.cursor/rules/system-architecture.mdc) - API κ³„μΈµ μ„¤κ³„

## π”— API μ—”λ“ν¬μΈνΈ λ…μ„Έ

### 1. μ§λ¬Έ κ²€μ¦ API

| ν•­λ© | λ‚΄μ© |
|---|---|
| **μ—”λ“ν¬μΈνΈ URL** | `/api/question` |
| **HTTP λ©”μ„λ“** | `POST` |
| **μ”μ²­ νλΌλ―Έν„°** | `question` (string, required) - μ‚¬μ©μ μ§λ¬Έ |
| **μ”μ²­ μμ‹** | `{ "question": "ν† λΌμ— λ€ν•΄ μ•λ ¤μ¤" }` |
| **μ‘λ‹µ κµ¬μ΅°** | `{ "success": true, "questionId": "uuid", "message": "μ§λ¬Έμ΄ κ²€μ¦λμ—μµλ‹λ‹¤" }` |

### 2. AI λ‹µλ³€ μƒμ„± API

| ν•­λ© | λ‚΄μ© |
|---|---|
| **μ—”λ“ν¬μΈνΈ URL** | `/api/generate` |
| **HTTP λ©”μ„λ“** | `POST` |
| **μ”μ²­ νλΌλ―Έν„°** | `questionId` (string, required) - μ§λ¬Έ ID |
| **μ”μ²­ μμ‹** | `{ "questionId": "uuid" }` |
| **μ‘λ‹µ κµ¬μ΅°** | `{ "success": true, "answer": "ν† λΌλ” ν¬μ λ™λ¬Όλ΅...", "answerId": "uuid" }` |

### 3. λ…μ  λ¶„ν•  API

| ν•­λ© | λ‚΄μ© |
|---|---|
| **μ—”λ“ν¬μΈνΈ URL** | `/api/split` |
| **HTTP λ©”μ„λ“** | `POST` |
| **μ”μ²­ νλΌλ―Έν„°** | `answerId` (string, required) - λ‹µλ³€ ID |
| **μ”μ²­ μμ‹** | `{ "answerId": "uuid" }` |
| **μ‘λ‹µ κµ¬μ΅°** | `{ "success": true, "propositions": ["ν† λΌλ” ν¬μ λ™λ¬Όμ΄λ‹¤", "ν† λΌλ” λΉ λ¥΄κ² λ‹¬λ¦΄ μ μλ‹¤"], "splitId": "uuid" }` |

### 4. κ²€μ¦ μ‹¤ν–‰ API (16κ° κ²€μ¦μ)

| ν•­λ© | λ‚΄μ© |
|---|---|
| **μ—”λ“ν¬μΈνΈ URL** | `/api/verify-v2` |
| **HTTP λ©”μ„λ“** | `POST` |
| **μ”μ²­ νλΌλ―Έν„°** | `splitId` (string, required) - λ¶„ν•  ID |
| **μ”μ²­ μμ‹** | `{ "splitId": "uuid" }` |
| **μ‘λ‹µ κµ¬μ΅°** | `{ "success": true, "verificationId": "uuid", "status": "started" }` |
| **κ²€μ¦μ κµ¬μ„±** | 16κ° κ²€μ¦μ (4x4 κ·Έλ¦¬λ“): λ…Όλ¦¬/μ‚¬μ‹¤/λ§¥λ½/μΆ…ν•© κ²€μ¦μ κ° 4κ°μ”© |
| **Rate Limiting** | λ¶„λ‹Ή 12κ° μ”μ²­ μ ν•, 2κ°μ”© λ°°μΉ μ²λ¦¬, 6μ΄ κ°„κ²© |

### 5. ν•©μ κ²°κ³Ό API (16κ° κ²€μ¦μ κΈ°μ¤€)

| ν•­λ© | λ‚΄μ© |
|---|---|
| **μ—”λ“ν¬μΈνΈ URL** | `/api/consensus` |
| **HTTP λ©”μ„λ“** | `GET` |
| **μ”μ²­ νλΌλ―Έν„°** | `verificationId` (string, required) - κ²€μ¦ ID |
| **μ”μ²­ μμ‹** | `/api/consensus?verificationId=uuid` |
| **μ‘λ‹µ κµ¬μ΅°** | `{ "success": true, "results": [{ "proposition": "ν† λΌλ” ν¬μ λ™λ¬Όμ΄λ‹¤", "votes": { "true": 10, "false": 6 }, "consensus": "true" }], "summary": { "total": 4, "true": 3, "false": 1 } }` |
| **ν•©μ κΈ°μ¤€** | 16κ° μ¤‘ κ³Όλ°μ(9κ° μ΄μƒ) νμ • |

### 6. μ‹¤μ‹κ°„ μ§„ν–‰λ¥  API

| ν•­λ© | λ‚΄μ© |
|---|---|
| **μ—”λ“ν¬μΈνΈ URL** | `/api/progress` |
| **HTTP λ©”μ„λ“** | `GET` |
| **μ”μ²­ νλΌλ―Έν„°** | `verificationId` (string, required) - κ²€μ¦ ID |
| **μ”μ²­ μμ‹** | `/api/progress?verificationId=uuid` |
| **μ‘λ‹µ κµ¬μ΅°** | `{ "success": true, "progress": 75, "currentStep": "verification", "completedValidators": 12, "totalValidators": 16 }` |

## π”§ API μ¤λ¥ ν•΄κ²° μ‚¬ν•­

### μ—”λ“ν¬μΈνΈ λΌμ°ν… μμ •
- **λ¬Έμ **: `/api/verify` μ—”λ“ν¬μΈνΈλ΅ μλ» μ”μ²­ν•μ—¬ 404 μ¤λ¥ λ°μƒ
- **ν•΄κ²°**: ν”„λ΅ νΈμ—”λ“μ—μ„ `/api/verify-v2` μ—”λ“ν¬μΈνΈλ΅ μ •ν™•ν μ”μ²­ν•λ„λ΅ μμ •
- **μν–¥**: VerificationProcessV2 μ»΄ν¬λ„νΈμ—μ„ μ¬λ°”λ¥Έ λ°±μ—”λ“ μ—”λ“ν¬μΈνΈ νΈμ¶

### Rate Limiting μµμ ν™”
- **λ¬΄λ£ ν‹°μ–΄ μ ν•**: Gemini API λ¶„λ‹Ή 15κ° μ”μ²­ μ ν•
- **ν•΄κ²° λ°©μ•**: 
  - λ¶„λ‹Ή 12κ° μ”μ²­μΌλ΅ μ—¬μ λ¥Ό λ‘ 
  - λ°°μΉ ν¬κΈ°λ¥Ό 8κ°μ—μ„ 2κ°λ΅ μ¶•μ†
  - λ°°μΉ κ°„ λ€κΈ° μ‹κ°„μ„ 1.5μ΄μ—μ„ 6μ΄λ΅ μ¦κ°€
  - κ° μ”μ²­ κ°„ 2μ΄ λ€κΈ° μ¶”κ°€
  - 429 μ¤λ¥ μ‹ 45μ΄ λ€κΈ° ν›„ μ¬μ‹λ„

### Gemini λ¨λΈ μ—…κ·Έλ μ΄λ“
- **κΈ°μ΅΄**: `gemini-2.0-flash-lite`
- **λ³€κ²½**: `gemini-2.5-flash-lite-preview-06-17`
- **μ¥μ **: λΉ„μ© ν¨μ¨μ„±κ³Ό μ €μ§€μ—° μµμ ν™”, λ†’μ€ μ²λ¦¬λ‰ μ§€μ›

## π― 16κ° κ²€μ¦μ μ‹μ¤ν…

### κ²€μ¦μ κµ¬μ„±
```
λ…Όλ¦¬ κ²€μ¦μ (4κ°) | μ‚¬μ‹¤ κ²€μ¦μ (4κ°)
λ§¥λ½ κ²€μ¦μ (4κ°) | μΆ…ν•© κ²€μ¦μ (4κ°)
```

### μ§„ν–‰λ¥  κ³„μ‚°
- **μ΄ λ‹¨κ³„**: 16κ° κ²€μ¦μ κ²€μ¦
- **μ§„ν–‰λ¥ **: (μ™„λ£λ κ²€μ¦μ μ / 16) Γ— 100
- **μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ**: WebSocket/SSEλ¥Ό ν†µν• μ¦‰μ‹ μ—…λ°μ΄νΈ

### ν•©μ λ©”μ»¤λ‹μ¦
- **νμ • κΈ°μ¤€**: 16κ° μ¤‘ κ³Όλ°μ(9κ° μ΄μƒ) λ™μ
- **κ²°κ³Ό ν‘μ‹**: κ° λ…μ λ³„ μ°¬μ„±/λ°λ€ ν¬ν‘μμ™€ μµμΆ… νμ •
- **μ‹ λΆ°λ„**: κ²€μ¦μλ³„ μ‹ λΆ°λ„ μ μ ν‘μ‹

